<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ø³Ú©Ù†Ø± QR Code</title>

  <!-- ÙÙˆÙ†Øª IRANSans -->
  <style>
    @font-face {
      font-display: swap;
      font-family: iransans;
      font-style: normal;
      font-weight: 500;
      src: url(https://s100.divarcdn.com/statics/2023/07/IRANSansWeb_Medium.d1f537d1.eot);
      src: url(https://s100.divarcdn.com/statics/2023/07/IRANSansWeb_Medium.9f338149.woff2) format("woff2"),
        url(https://s100.divarcdn.com/statics/2023/07/IRANSansWeb_Medium.2d28b58d.woff) format("woff"),
        url(https://s100.divarcdn.com/statics/2023/07/IRANSansWeb_Medium.dde1bbb6.ttf) format("truetype");
    }

    body {
      direction: rtl;
      background-color: rgb(202, 215, 248);
      font-family: iransans, sans-serif;
      text-align: center;
    }

    .div-1 {
      width: 90%;
      max-width: 300px;
      height: 400px;
      background-color: rgb(234, 230, 230);
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .container {
      margin-top: 40px;
      direction: rtl;
    }

    .menu {
      margin-bottom: 20px;
    }

    .menu button {
      background: #eee;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 5px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .menu button:hover {
      background: #007bff;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .menu button.active {
      background: #007bff;
      color: white;
    }

    #result {
      margin-top: 20px;
      font-weight: bold;
    }

    #reader {
      border: 2px dashed #007bff;
      border-radius: 10px;
      padding: 10px;
      background-color: #f8f9fa;
    }

    #galleryContainer input[type="file"] {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 6px;
      background-color: #fff;
    }
  </style>

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ -->
  <script src="https://unpkg.com/html5-qrcode"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>

<body>
  <div style="margin: 40px; text-align: center;">
    <h1><span
        style="background: linear-gradient(to bottom, rgb(43, 5, 179), rgb(76, 49, 253), rgb(91, 117, 250)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">QR</span>
      Code Scanner</h1>
  </div>

  <div class="div-1">
    <div class="container">
      <div class="menu">
        <button id="cameraMode" class="active">ğŸ“· Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±</button>
        <button id="galleryMode">ğŸ–¼ï¸ Ú¯Ø§Ù„Ø±ÛŒ</button>
      </div>

      <!-- Ø­Ø§Ù„Øª Ø¯ÙˆØ±Ø¨ÛŒÙ† -->
      <div id="cameraContainer">
        <div id="reader" style="width: 250px; margin: auto;"></div>
      </div>

      <!-- Ø­Ø§Ù„Øª Ú¯Ø§Ù„Ø±ÛŒ -->
      <div id="galleryContainer" style="display: none;">
        <br><br>
        <input type="file" id="fileInput" accept="image/*" />
        <p style="font-size: 15px;">ÛŒÚ© ØªØµÙˆÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† ØªØ§ QR Ø¢Ù† Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´ÙˆØ¯.</p>
      </div>

      <p id="result"></p>
    </div>
  </div>

  <div id="reader-temp" style="width: 1px; height: 1px; opacity: 0;"></div>

  <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª QR -->
  <script>
    // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    const cameraBtn = document.getElementById("cameraMode");
    const galleryBtn = document.getElementById("galleryMode");

    // Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§
    const cameraContainer = document.getElementById("cameraContainer");
    const galleryContainer = document.getElementById("galleryContainer");

    const resultText = document.getElementById("result");
    let html5QrCode;

    // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø¨ÛŒÙ† Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ú¯Ø§Ù„Ø±ÛŒ
    cameraBtn.onclick = () => {
      cameraBtn.classList.add("active");
      galleryBtn.classList.remove("active");
      cameraContainer.style.display = "block";
      galleryContainer.style.display = "none";
      startCamera();
    };

    galleryBtn.onclick = () => {
      galleryBtn.classList.add("active");
      cameraBtn.classList.remove("active");
      cameraContainer.style.display = "none";
      galleryContainer.style.display = "block";
      stopCamera();
    };

    // Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø¨Ø§ Ø¯ÙˆØ±Ø¨ÛŒÙ†
    function startCamera() {
      if (!html5QrCode) {
        html5QrCode = new Html5Qrcode("reader");
      }

      Html5Qrcode.getCameras()
        .then((devices) => {
          if (devices && devices.length) {
            html5QrCode
              .start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                (decodedText) => handleResult(decodedText),
                (error) => console.warn(error)
              )
              .catch((err) => console.error("Start error:", err));
          } else {
            alert("Ù‡ÛŒÚ† Ø¯ÙˆØ±Ø¨ÛŒÙ†ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´Ø¯.");
          }
        })
        .catch((err) => console.error("Camera error:", err));
    }

    // ØªÙˆÙ‚Ù Ø¯ÙˆØ±Ø¨ÛŒÙ†
    function stopCamera() {
      if (html5QrCode) {
        html5QrCode.stop().catch(() => { });
      }
    }

    // Ø§Ø³Ú©Ù† Ø§Ø² Ú¯Ø§Ù„Ø±ÛŒ
    document.getElementById("fileInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const galleryQrCode = new Html5Qrcode("reader-temp");
      galleryQrCode
        .scanFile(file, true)
        .then((decodedText) => handleResult(decodedText))
        .catch((err) => {
          alert("Ú©Ø¯ÛŒ Ø¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ ØªØµÙˆÛŒØ± Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª.");
          console.error(err);
        })
        .finally(() => galleryQrCode.clear());
    });

    // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
    function handleResult(decodedText) {
      stopCamera();
      resultText.innerHTML = `ğŸ” Ù†ØªÛŒØ¬Ù‡: <b>${decodedText}</b>`;

      if (decodedText.startsWith("http")) {
        resultText.innerHTML += `<br><a href="${decodedText}" target="_blank" class="btn btn-primary mt-2">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú©</a>`;
      }
    }

    // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ Ø¯ÙˆØ±Ø¨ÛŒÙ†
    startCamera();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
</body>

</html>
